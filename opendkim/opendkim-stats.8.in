.TH OPENDKIM-STATS 8 "The OpenDKIM Project"
.SH NAME
opendkim-stats - output opendkim statistics
.SH SYNOPSIS
.B opendkim-stats [options]
.I file
.SH DESCRIPTION
The
.B opendkim-stats
utility reads from an
.I opendkim
statistics database and dumps the data therein to standard output.  It takes as
its only argument the path to this database.  The
.I opendkim
statistics gathering is disabled by default, but can be enabled through a
.I Statistics
entry in
.I /etc/opendkim.conf.

See the
.I opendkim.conf(5)
man page for details.
.SH OPTIONS
.TP
.I -a
Don't anonymize output by replacing the sending domain and IP address in each
record with an MD5 hash of their actual values.  By default the data are
anonymized.
.TP
.I -c
Output columnar format rather than comma-separated key-value format.
.TP
.I -h name
Uses
.I name
as the name of the reporting host instead of the value returned by
.I gethostname(3).
This is only used with
.I -c
(above) when creating input suitable for database import.
.TP
.I -i
Initialize the named database.  The database is created if it doesn't
already exist, and a version record is added to it.  This must be done
before the filter can make use of the database to record data.
.TP
.I -m address
Send the report to the specified address by creating a pipe to
.I sendmail(8)
and feeding it the output with appropriate arguments.
.TP
.I -r
When used with
.I -m,
on successful transmission of the report, this option causes the database
to be reset (i.e. all data other than the version record will be deleted).
.SH OUTPUT
.B opendkim-stats
produces a report with a number of values associated with each MTA job ID
for which signed mail has been received.  The first column contains the
job ID, the second contains the sending domain, the third contains the sending
IP address, and the fourth is a comma-separated list of "key=value" strings.
The keys and their values are as follows:
.TP
.I when
Timestamp of the last signed message seen from this domain (UNIX time format).
.TP
.I alg
Integer representation of the signing algorithm seen on this message.
Only author signatures are recorded in this way.
.TP
.I hc
Integer representation of the header canonicalization seen on this message.
Only author signatures are recorded in this way.
.TP
.I bc
Integer representation of the body canonicalization seen on this message.
Only author signatures are recorded in this way.
.TP
.I total
Count of signatures on this message.
.TP
.I pass
Count of passing signatures on this message.
.TP
.I fail
Count of failing signatures on this message.
.TP
.I failbody
Count of failing signatures on this message where the failure could
specifically be attributed to a change in the message body (i.e. the signature
matched, but the "bh" tag value did not match).
.TP
.I ext
Count of signatures on this message where the message was extended after
signing.  This means the message contained one or more signature(s) with an
"l=" tag, but the received message had a body length larger than that
value.
.TP
.I keyt
Count of signatures on this message that referred to a key record that had
a "t=" tag.
.TP
.I keyg
Count of signatures on this message that referred to a key record that had
a "g=" tag.
.TP
.I keysyntax
Count of signatures on this message that referred to a key record that had
a syntax error.
.TP
.I keynx
Count of signatures on this message that referred to a key record that could
not be retrieved from the DNS.
.TP
.I keydk
Count of signatures on this mesasge that referred to a key record that appeared
to be formatted for DomainKeys instead of DKIM.
.TP
.I dnssecunk
Count of signatures whose keys were not evaluated by DNSSEC.
.TP
.I dnssecbogus
Count of signatures whose keys were determined by DNSSEC to be falsified.
.TP
.I dnssecinsec
Count of signatures whose keys were determined by DNSSEC to be unsecured.
.TP
.I dnssecec
Count of signatures whose keys were determined by DNSSEC to be secured.
.TP
.I sigt
Count of signatures on this message that contained a "t=" tag.
.TP
.I sigtfut
Count of signatures on this message that contained a "t=" tag with a
timestamp in the future.
.TP
.I sigx
Count of signatures on this message that contained an "x=" tag.
.TP
.I sigl
Count of signatures on this message that contained an "l=" tag.
.TP
.I sigz
Count of signatures on this message that contained a "z=" tag.
.TP
.I adspfound
If this message provoked an ADSP query that succeeded, this value will be 1.
Otherwise, this value will be 0.
.TP
.I adspunknown
If an ADSP query was done and returned "all", this value will be 1.
Otherwise, it will be 0.
.TP
.I adspall
If an ADSP query was done and returned "all", this value will be 1.
Otherwise, it will be 0.
.TP
.I adspdisc
If an ADSP query was done and returned "discardable", this value will be 1.
Otherwise, it will be 0.
.TP
.I adspfail
If this message did not have a valid author domain signature, this value will
be 1.  Otherwise, it will be 0.
.TP
.I asigs
Count of valid signatures on this message for which the "d=" (signing domain)
tag matched the domain in the From: header field; that is, a count of valid
author signatures.
.TP
.I asigsfail
Count of invalid signatures on this message for which the "d=" (signing domain)
tag matched the domain in the From: header field; that is, a count of invalid
author signatures.
.TP
.I tpsigs
Count of valid signatures on this message for which the "d=" (signing domain)
tag did not match the domain in the From: header field; that is, a count of
valid third-party signatures.
.TP
.I tpsigsfail
Count of invalid signatures on this message for which the "d=" (signing domain)
tag did not match the domain in the From: header field; that is, a count of
invalid third-party signatures.
.TP
.I mlist
If at least one typical mailing list header field was present (e.g.,
a Precedence: header field containing "list", or the presence of a List-Id:,
List-Post:, List-Unsubscribe: or Mailing-List: header field), this value will
be 1; otherwise, it will be 0.
.TP
.I rhcnt
Count of Received: header fields on the message.
.SH NOTES
The output of
.B opendkim-stats
is subject to change.  Please be aware of this when upgrading to future
releases, especially if you develop any scripts that consume the output.

The current version of the OpenDKIM statistics system is 2.  Generally,
.I opendkim-stats
can read all database versions, but
.I opendkim(8)
will only generate the most recent version (and will refuse to update older
databases).
.SH SEE ALSO
.I opendkim(8)
.SH VERSION
This man page covers the
.I opendkim-stats
that shipped with version @VERSION@ of
.I OpenDKIM.
.SH HISTORY
This original version of this man page was contributed by
Mike Markley <mike@markley.org> for the Debian project.
